<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="#JulyOT RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="#JulyOT Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4LCHFKPDVJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4LCHFKPDVJ",{anonymize_ip:!0})</script>



<script>!function(t,e,n,c,a,s,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(c)).async=1,s.src="https://www.clarity.ms/tag/chk0ns2za1",(r=e.getElementsByTagName(c)[0]).parentNode.insertBefore(s,r)}(window,document,"clarity","script")</script><title data-rh="true">15: .NET nanoFramework networking and Azure | #JulyOT</title><meta data-rh="true" property="og:image" content="https://JulyOT.dev/img/png/julyot-card.png"><meta data-rh="true" property="og:url" content="https://JulyOT.dev/blog/15-nano-framework"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="msvalidate.01" content="7EBB3CA4C71A21C77534F4358EAE87A2"><meta data-rh="true" name="keywords" content="iot, internet of things, julyot, ai, embedded"><meta data-rh="true" property="og:title" content="15: .NET nanoFramework networking and Azure | #JulyOT"><meta data-rh="true" name="description" content="Welcome to Day 15 of #JulyOT!"><meta data-rh="true" property="og:description" content="Welcome to Day 15 of #JulyOT!"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-07-15T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ellerbach,https://github.com/josesimoes"><meta data-rh="true" property="article:tag" content="30days,iot,embeddediot"><meta data-rh="true" name="twitter:url" content="https://julyot.dev/blog/15-nano-framework"><meta data-rh="true" name="twitter:title" content=".NET nanoFramework networking and Azure"><meta data-rh="true" name="twitter:description" content=".NET nanoFramework networking and Azure"><meta data-rh="true" name="twitter:image" content="https://julyot.dev/img/png/JulyOT-banner-15-nanoframework.png"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:creator" content="@ellerbach"><meta data-rh="true" name="twitter:site" content="@AzureAdvocates"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://JulyOT.dev/blog/15-nano-framework" hreflang="en"><link data-rh="true" rel="alternate" href="https://JulyOT.dev/blog/15-nano-framework" hreflang="x-default"><link data-rh="true" rel="canonical" href="https://julyot.dev/blog/15-nano-framework"><link rel="stylesheet" href="/assets/css/styles.bbcf359b.css">
<link rel="preload" href="/assets/js/runtime~main.ac7cffa6.js" as="script">
<link rel="preload" href="/assets/js/main.8e07fc21.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#0D1E4E;color:#7EE2FB" role="banner"><div class="announcementBarContent_xLdY"><b>Join the <a href="https://docs.microsoft.com/learn/challenges?id=261fd583-fa7b-4b1f-86eb-6a52b5468a23&wt.mc_id=eventspg_16482_webpage_reactor" target="_blank"><b>IoT Cloud Skills Challenge</b></a> and build expertise in implementing the configuration and coding tasks required to create and maintain the cloud and edge portions of an IoT solution.</b></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/svg/julyot.svg" alt="JulyOT Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/svg/julyot.svg" alt="JulyOT Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">#JulyOT</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/skills">Cloud Skills</a><a class="navbar__item navbar__link" href="/digitalswag">Digital Swag</a><a class="navbar__item navbar__link" href="/livestreams">Live Streams</a><a class="navbar__item navbar__link" href="/meetups">Meetups and Events</a><a class="navbar__item navbar__link" href="/resources">Resources</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Archives</a><ul class="dropdown__menu"><li><a href="https://techcommunity.microsoft.com/t5/internet-of-things-blog/julyot-2021-31-days-of-iot-content-for-everyone/ba-p/2427431?WT.mc_id=eventspg_16482_webpage_reactor" target="_blank" rel="noopener noreferrer" class="dropdown__link">#JulyOT 2021<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://techcommunity.microsoft.com/t5/internet-of-things-blog/julyot-a-month-of-learning-focused-on-azure-iot-solutions/ba-p/1497040?WT.mc_id=eventspg_16482_webpage_reactor" target="_blank" rel="noopener noreferrer" class="dropdown__link">#JulyOT 2020<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/JulyOT/JulyOT" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Most Recent Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day29-az220">29: Exam AZ-220 Study Guide - Implement Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022-07-29-azure-percept-edge-ai">29: Discover how Azure Percept can deliver Edge AI solutions at scale in partnership with NVIDIA</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/29-nano-framework">29: .NET nanoFramework Engineering Fundamentals</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day28-az220">28: Exam AZ-220 Study Guide - Monitor, Troubleshoot, and Optimize IoT Solutions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day27-az220">27: Exam AZ-220 Study Guide - Process and Manage Data</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/build-industrial-iot">27: Building Industrial IoT applications with the Microsoft Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day26-az220">26: Exam AZ-220 Study Guide - Implement Business Integration</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/26-lgpc-altair">26: Let&#x27;s get personal: Computing - Retro computing with Dave Glover and the Altair 8800</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day25-az220">25: Exam AZ-220 Study Guide - Implement IoT Edge</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/25-azure-percept-learn-modules">25: Azure Percept Learn Path</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day24-az220">24: Exam AZ-220 Study Guide - Provision and Manage Devices</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day23-az220">23: Exam AZ-220 Study Guide - Set up the IoT solution infrastructure</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/23-azure-cost-monitor">23: Azure cost monitor</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/22-julyot-iot-beginners">22: IoT for Beginners lesson 4!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/22-nano-framework">22: Building .NET nanoFramework and interoperability</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day21-az220">21: Microsoft Certified - Azure IoT Developer Specialty</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/21-project-bonsai">21: Creating intelligent autonomous systems with project bonsai</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/20-azure-iot-pi-reterminal-juliot">20: Azure IoT con Raspberry Pi y reTerminal</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/20-azure-iot-pi-reterminal">20: Azure IoT with a Raspberry Pi and reTerminal</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day19-embedded">19: Powering Azure Sphere C Development with DevX</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/18-azure-percept-blog-posts">18: Unlimited possibilities with Azure Percept</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/16-iot-devices-for-prototyping">16: IoT Device Selection List for Prototyping</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/15-julyot-iot-beginners">15: IoT for Beginners lesson 3!</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/15-nano-framework">15: .NET nanoFramework networking and Azure</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/14-iot-cow">14: AMA: IoT, cows, AI and poop - Jim discusses IoT in farming with Bryn Lewis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/13-iot-ama">13: Ask Me Anything at Reactor: Azure IoT!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day12-embedded">12: AI-powered predictive maintenance with Azure Sphere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/11-cohetes-de-agua">11: Cohetes de agua - Water rockets!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/11-azure-percept-conference-sessions">11: Learn Azure Percept from conference sessions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/09-azure-circuit-python">09: Getting Started with Microsoft Azure and CircuitPython</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/08-julyot-iot-beginners">08: IoT for Beginners lesson 2!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/08-nano-framework">08: .NET nanoFramework GPIO, I2C, SPI and other IO support</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/07-closed-captioning-rpi">07: A Closed Captioning Example on Raspberry Pi using Azure Cognitive services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/07-pnpflow">07: Plug and Play IoT device development with PnPFlow</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/06-edge-impulse-competition">06: Edge Impulse Project of the Month competition</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day5-embedded">05: Altair Everywhere</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day4">04: Detect the very big with the very small – counting bears with TinyML meetup from IoT North</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-day2">02: IoT for beginners</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/01-nano-framework">01: Getting started with nanoFramework!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/01-julyot-kickoff">01: Welcome to #JulyOT!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/julyot-teaser">00: #JulyOT Is Coming!</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">15: .NET nanoFramework networking and Azure</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-07-15T00:00:00.000Z" itemprop="datePublished">July 15, 2022</time> · <!-- -->27 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/ellerbach" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/ellerbach.png" alt="Laurent Ellerbach"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ellerbach" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Laurent Ellerbach</span></a></div><small class="avatar__subtitle" itemprop="description">Principal Engineering Manager @Microsoft</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/josesimoes" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/josesimoes.png" alt="José Simões"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/josesimoes" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">José Simões</span></a></div><small class="avatar__subtitle" itemprop="description">CEO @Eclo Solutions</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><blockquote><p>Welcome to Day 15 of <strong>#JulyOT</strong>!</p></blockquote><p><img loading="lazy" alt="Page banner" src="/assets/images/JulyOT-banner-15-nanoframework-421c49d0c1596d498b07483ef6b74ef2.png" width="1000" height="420" class="img_ev3q"></p><h1>Networking and Azure</h1><p>.NET nanoFramework offers native secure network capabilities. The capabilities may differ depending on the MCU and associated hardware but if there is an ethernet adaptor or a Wi-Fi module, except if they are extremely exotic, they&#x27;ll be supported! For example, the ESP32 supports secure Wi-Fi connectivity, all certificates to authenticate servers and devices are supported making the connection secure from end to end using the underlying TLS/SSL.</p><p>Watch the <a href="https://www.youtube.com/watch?v=pxXgU3XcRr4" target="_blank" rel="noopener noreferrer">Connect to Azure IoT</a> &quot;IoT Show&quot; episode to learn more about creating secure connections.</p><p><a href="https://youtube.com/watch?v=pxXgU3XcRr4" target="_blank" rel="noopener noreferrer" title="Connect to Azure IoT video"><img loading="lazy" src="https://img.youtube.com/vi/pxXgU3XcRr4/0.jpg" alt="Connect to Azure IoT video" class="img_ev3q"></a></p><p>Connecting to Azure IoT is easy with library support for Device Provisioning Services (DPS), SAS token and certificate authentication, Cloud to Device (C2D) messages, Device to Cloud (D2C) messages, remote function calls, twins, for clients and modules! There is also full support for <a href="https://github.com/nanoframework/nanoFramework.Azure.Devices" target="_blank" rel="noopener noreferrer">IoT Plug &amp; Play</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="announcing-the-first-net-nanoframework-azure-certified-device">Announcing the first .NET nanoFramework Azure Certified Device<a class="hash-link" href="#announcing-the-first-net-nanoframework-azure-certified-device" title="Direct link to heading">​</a></h2><p>In May 2022, the PalThree device from OrgPal based on an STM32F7 MCU is the first <a href="https://www.nanoframework.net/palthree-board-becomes-azure-certified-device/" target="_blank" rel="noopener noreferrer">Azure Certified Device running .NET nanoFramework</a> to be approved. This device is also IoT Plug and Play certified. The .NET nanoFramework is ready for production.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="net-nanoframework-communications-capabilities">.NET nanoFramework communications capabilities<a class="hash-link" href="#net-nanoframework-communications-capabilities" title="Direct link to heading">​</a></h2><p>The .NET nanoFramework supports a wide range of communicators protocols including:</p><ol><li>TLS,</li><li>HTTPS,</li><li>.NET nanoFramework WebServer,</li><li>WebSockets,</li><li>SignalR,</li><li>MQTT, including support for MQTT v5.0,</li><li><a href="https://github.com/nanoframework/amqpnetlite" target="_blank" rel="noopener noreferrer">AMQP</a>,</li><li><a href="https://github.com/nanoframework/System.Net.Sockets.TcpClient" target="_blank" rel="noopener noreferrer">TcpClient</a>,</li><li>and <a href="https://github.com/nanoframework/System.Net.Sockets.UdpClient" target="_blank" rel="noopener noreferrer">UdpClient</a>.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tls-and-https">TLS and HTTPS<a class="hash-link" href="#tls-and-https" title="Direct link to heading">​</a></h2><p>TLS and secure HTTP is supported. You will find examples in the <a href="https://github.com/nanoframework/Samples/tree/main/samples/HTTP" target="_blank" rel="noopener noreferrer">sample repository</a>. The samples demonstrate how to use <code>WebRequest</code>, <code>HttpListener</code> as well as how to make low-level REST calls to Azure services.</p><p>HttpClient is fully implemented and is a very convenient way to call REST services.  HttpClient works just like the full .NET implementation. You&#x27;ll find the source in the .NET nanoFramework <a href="https://github.com/nanoframework/System.Net.Http" target="_blank" rel="noopener noreferrer">System.Net.Http</a> repository.</p><p>To use <code>HttpClient</code>, create the HttpClient object and then perform calls. Note that <code>HttpClient</code> is meant to be reused throughout the application lifecycle. There is no need to create a new instance every time a call has to be performed. Like this:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static readonly HttpClient _httpClient = new HttpClient();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To pass the CA root certificate to validate the secure server certificate. The CA root cert can also come from a binary file or text file from a resource.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_httpClient.HttpsAuthentCert = new X509Certificate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@&quot;-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIIEDzCCAvegAwIBAgIBADANBgkqhkiG9w0BAQUFADBoMQswCQYDVQQGEwJVUzEl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MCMGA1UEChMcU3RhcmZpZWxkIFRlY2hub2xvZ2llcywgSW5jLjEyMDAGA1UECxMp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">U3RhcmZpZWxkIENsYXNzIDIgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwHhcNMDQw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NjI5MTczOTE2WhcNMzQwNjI5MTczOTE2WjBoMQswCQYDVQQGEwJVUzElMCMGA1UE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ChMcU3RhcmZpZWxkIFRlY2hub2xvZ2llcywgSW5jLjEyMDAGA1UECxMpU3RhcmZp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZWxkIENsYXNzIDIgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwggEgMA0GCSqGSIb3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DQEBAQUAA4IBDQAwggEIAoIBAQC3Msj+6XGmBIWtDBFk385N78gDGIc/oav7PKaf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8MOh2tTYbitTkPskpD6E8J7oX+zlJ0T1KKY/e97gKvDIr1MvnsoFAZMej2YcOadN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+lq2cwQlZut3f+dZxkqZJRRU6ybH838Z1TBwj6+wRir/resp7defqgSHo9T5iaU0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X9tDkYI22WY8sbi5gv2cOj4QyDvvBmVmepsZGD3/cVE8MC5fvj13c7JdBmzDI1aa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">K4UmkhynArPkPw2vCHmCuDY96pzTNbO8acr1zJ3o/WSNF4Azbl5KXZnJHoe0nRrA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1W4TNSNe35tfPe/W93bC6j67eA0cQmdrBNj41tpvi/JEoAGrAgEDo4HFMIHCMB0G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A1UdDgQWBBS/X7fRzt0fhvRbVazc1xDCDqmI5zCBkgYDVR0jBIGKMIGHgBS/X7fR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zt0fhvRbVazc1xDCDqmI56FspGowaDELMAkGA1UEBhMCVVMxJTAjBgNVBAoTHFN0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YXJmaWVsZCBUZWNobm9sb2dpZXMsIEluYy4xMjAwBgNVBAsTKVN0YXJmaWVsZCBD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bGFzcyAyIENlcnRpZmljYXRpb24gQXV0aG9yaXR5ggEAMAwGA1UdEwQFMAMBAf8w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DQYJKoZIhvcNAQEFBQADggEBAAWdP4id0ckaVaGsafPzWdqbAYcaT1epoXkJKtv3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L7IezMdeatiDh6GX70k1PncGQVhiv45YuApnP+yz3SFmH8lU+nLMPUxA2IGvd56D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eruix/U0F47ZEUD0/CwqTRV/p2JdLiXTAAsgGh1o+Re49L2L7ShZ3U0WixeDyLJl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xy16paq8U4Zt3VekyvggQQto8PT7dL5WXXp59fkdheMtlb71cZBDzI0fmgAKhynp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VSJYACPq4xJDKVtHCN2MQWplBqjlIapBtJUhlbl90TSrE9atvNziPTnNvT51cKEY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WQPJIrSPnNVeKtelttQKbfi3QBFGmh95DmK/D5fs4C8fF5Q=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----END CERTIFICATE-----&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s possible to add HTTP headers that will be sent with each request.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_httpClient.DefaultRequestHeaders.Add(&quot;x-ms-blob-type&quot;, &quot;BlockBlob&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="perform-an-http-get-request">Perform an HTTP GET request<a class="hash-link" href="#perform-an-http-get-request" title="Direct link to heading">​</a></h3><p>Here&#x27;s a example of a HTTP request to read some content as a string:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HttpResponseMessage response = _httpClient.Get(&quot;https://httpbin.org/get&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response.EnsureSuccessStatusCode();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var responseBody = response.Content.ReadAsString();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above call would return something similar to the following, which can be output in Visual Studio by calling <code>Debug.WriteLine(responseBody)</code>:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;args&quot;: {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;headers&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Host&quot;: &quot;httpbin.org&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-6214aad3-38e5f8357bdf90530300eb5f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;X-Ms-Blob-Type&quot;: &quot;BlockBlob&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;origin&quot;: &quot;5.249.47.208&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;url&quot;: &quot;https://httpbin.org/get&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note the call to <code>response.EnsureSuccessStatusCode();</code>. This will throw an <code>HttpRequestException</code> in case the status code from the HTTP request is not a successful one.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="perform-an-http-post-request">Perform an HTTP POST request<a class="hash-link" href="#perform-an-http-post-request" title="Direct link to heading">​</a></h3><p>Following is an example of an HTTP request performing a POST request to send some JSON content to an endpoint.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var content = new StringContent(&quot;{\&quot;someProperty\&quot;:\&quot;someValue\&quot;}&quot;, Encoding.UTF8, &quot;application/json&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var result = _httpClient.Post(&quot;https://httpbin.org/anything&quot;, content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result.EnsureSuccessStatusCode();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Worth noting that the JSON content above it&#x27;s presented as a simple string to simplify the code. There is a <a href="https://github.com/nanoframework/nanoFramework.Json" target="_blank" rel="noopener noreferrer">json library</a> available to help with serializing and deserializing from/to C# classes, even the most complex ones.</p><p>Note the call to <code>response.EnsureSuccessStatusCode();</code> to make sure the HTTP request was successfully performed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-binary-content-to-a-file">Download binary content to a file<a class="hash-link" href="#download-binary-content-to-a-file" title="Direct link to heading">​</a></h3><p>Using <code>HttpClient</code> makes it easy to deal with binary content. The following is an example of how to download a file from a web server.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HttpResponseMessage response = _httpClient.Get(&quot;https://storage-on-the-cloud.net/file-with-binary-content&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response.EnsureSuccessStatusCode();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using FileStream fs = new FileStream($&quot;I:\\i-am-a-binary-file.bin&quot;, FileMode.Create, FileAccess.Write);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response.Content.ReadAsStream().CopyTo(fs);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-through-a-reverse-proxy">Debugging through a reverse proxy<a class="hash-link" href="#debugging-through-a-reverse-proxy" title="Direct link to heading">​</a></h3><p>When code is deployed to an MCU it might be desirable to let the device connect to your development machine running IIS Express. This can be achieved with a proxy such as <a href="https://www.npmjs.com/package/iisexpress-proxy" target="_blank" rel="noopener noreferrer">iisexpress-proxy</a>.</p><p>Be aware that this leads to SocketExceptions with the current version of <strong>nanoFramework</strong> System.Net.Http when sending consecutive requests to your development machine. A simple retry mechanism in Debug mode will get around this.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webserver-almost-like-full-aspnet">WebServer: almost like full ASP.NET<a class="hash-link" href="#webserver-almost-like-full-aspnet" title="Direct link to heading">​</a></h2><p>The title is correct, we kept the core ideas of the full ASP.NET framework. We shrink everything possible, but kept the controller, security authentication, and attribute decoration concepts. You&#x27;ll find the source in the .NET nanoFramework <a href="https://github.com/nanoframework/nanoFramework.WebServer" target="_blank" rel="noopener noreferrer">WebServer</a> repository. Features include:</p><ul><li>Handling multi-thread requests</li><li>Serve static files on any storage</li><li>Handle parameters in URL</li><li>Multiple WebServer running at the same time</li><li>Supports GET/PUT</li><li>Supports content in POST</li><li>Supports any type of header</li><li>Reflection for easy usage of controllers and routes</li><li>Helpers to return error codes</li><li>HTTPS support</li><li><a href="https://github.com/nanoframework/lib-nanoFramework.System.Net.Http/blob/develop/nanoFramework.System.Net.Http/Http/System.Net.HttpUtility.cs" target="_blank" rel="noopener noreferrer">URL decode/encode</a></li></ul><p>The main limitations are:</p><ul><li>No zip support for request or response streams</li><li>No built-in dependency injection. This is coming and in private preview for the moment</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">​</a></h3><p>Specify a port, a timeout for the queries, and add an event handler for incoming requests.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using (WebServer server = new WebServer(80, HttpProtocol.Http)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add a handler for commands that are received by the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.CommandReceived += ServerCommandReceived;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Start the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread.Sleep(Timeout.Infinite);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also pass a controller and routes and method decoration is supported.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using (WebServer server = new WebServer(80, HttpProtocol.Http, new Type[] { typeof(ControllerPerson), typeof(ControllerTest) }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Start the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread.Sleep(Timeout.Infinite);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, you&#x27;re passing 2 classes where you have public methods decorated which will be called every time the route is found.</p><p>With the previous example, a straightforward Test controller will look like that:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ControllerTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Route(&quot;test&quot;), Route(&quot;Test2&quot;), Route(&quot;test42&quot;), Route(&quot;TEST&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [CaseSensitive]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Method(&quot;GET&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void RoutePostTest(WebServerEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string route = $&quot;The route asked is {e.Context.Request.RawUrl.TrimStart(&#x27;/&#x27;).Split(&#x27;/&#x27;)[0]}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.Context.Response.ContentType = &quot;text/plain&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WebServer.OutPutStream(e.Context.Response, route);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Route(&quot;test/any&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void RouteAnyTest(WebServerEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WebServer.OutputHttpCode(e.Context.Response, HttpStatusCode.OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the <code>RoutePostTest</code> routes are case sensitive as the routes are decorated with <!-- -->[CaseSensitive]<!-- -->. GET requests to routes <code>test</code>, <code>Test2</code>, <code>test42</code>, or <code>TEST</code> will succeed. A GET request to <code>Test</code> would fail. GET parameters are also supported.</p><p>The <code>RouteAnyTest</code>is called whenever the URL <code>test/any</code> is requested no matter what method is used.</p><p>There is a more advanced example with a simple REST API to get a list of Person and add a Person. Check it in the <a href="https://github.com/nanoframework/Samples/blob/main/samples/Webserver/WebServer.Sample/ControllerPerson.cs" target="_blank" rel="noopener noreferrer">sample</a>.</p><blockquote><p><strong>Important</strong>:</p><ul><li>By default, the routes are not case sensitive and the attribute <strong>must</strong> be lowercase</li><li>If you want to use case-sensitive routes like in the previous example, use the attribute <code>CaseSensitive</code>. As in the previous example, you <strong>must</strong> write the route as you want it to be responded to.</li></ul></blockquote><p>And you can pass default credentials to the server:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using (WebServer server = new WebServer(80, HttpProtocol.Http, new Type[] { typeof(ControllerPerson), typeof(ControllerTest), typeof(ControllerAuth) }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // To test authentication with various scenarios</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.ApiKey = &quot;ATopSecretAPIKey1234&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.Credential = new NetworkCredential(&quot;topuser&quot;, &quot;topPassword&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Start the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread.Sleep(Timeout.Infinite);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="managing-incoming-queries-thru-events">Managing incoming queries thru events<a class="hash-link" href="#managing-incoming-queries-thru-events" title="Direct link to heading">​</a></h3><p>Very basic usage is the following:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private static void ServerCommandReceived(object source, WebServerEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var url = e.Context.Request.RawUrl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Command received: {url}, Method: {e.Context.Request.HttpMethod}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (url.ToLower() == &quot;/sayhello&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // This is simple raw text returned</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WebServer.OutPutStream(e.Context.Response, &quot;It&#x27;s working, url is empty, this is just raw text, /sayhello is just returning a raw text&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WebServer.OutputHttpCode(e.Context.Response, HttpStatusCode.NotFound);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can do more advance scenario like returning a full HTML page:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WebServer.OutPutStream(e.Context.Response, &quot;&lt;html&gt;&lt;head&gt;&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&lt;title&gt;Hi from nanoFramework Server&lt;/title&gt;&lt;/head&gt;&lt;body&gt;You want me to say hello in a real HTML page!&lt;br/&gt;&lt;a href=&#x27;/useinternal&#x27;&gt;Generate an internal text.txt file&lt;/a&gt;&lt;br /&gt;&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&lt;a href=&#x27;/Text.txt&#x27;&gt;Download the Text.txt file&lt;/a&gt;&lt;br&gt;&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Try this url with parameters: &lt;a href=&#x27;/param.htm?param1=42&amp;second=24&amp;NAme=Ellerbach&#x27;&gt;/param.htm?param1=42&amp;second=24&amp;NAme=Ellerbach&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And can get parameters from a URL a an example from the previous link on the param.html page:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (url.ToLower().IndexOf(&quot;/param.htm&quot;) == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Test with parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var parameters = WebServer.decryptParam(url);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string toOutput = &quot;&lt;html&gt;&lt;head&gt;&quot; +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&lt;title&gt;Hi from nanoFramework Server&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Here are the parameters of this URL: &lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (var par in parameters)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        toOutput += $&quot;Parameter name: {par.Name}, Value: {par.Value}&lt;br /&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toOutput += &quot;&lt;/body&gt;&lt;/html&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebServer.OutPutStream(e.Context.Response, toOutput);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And server static files:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var files = storage.GetFiles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach (var file in files)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (file.Name == url)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WebServer.SendFileOverHTTP(e.Context.Response, file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebServer.OutputHttpCode(e.Context.Response, HttpStatusCode.NotFound);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And also <strong>REST API</strong> is supported, here is a comprehensive example:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (url.ToLower().IndexOf(&quot;/api/&quot;) == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string ret = $&quot;Your request type is: {e.Context.Request.HttpMethod}\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret += $&quot;The request URL is: {e.Context.Request.RawUrl}\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var parameters = WebServer.DecodeParam(e.Context.Request.RawUrl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (parameters != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += &quot;List of url parameters:\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (var param in parameters)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret += $&quot;  Parameter name: {param.Name}, value: {param.Value}\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (e.Context.Request.Headers != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += $&quot;Number of headers: {e.Context.Request.Headers.Count}\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += &quot;There is no header in this request\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (var head in e.Context.Request.Headers?.AllKeys)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += $&quot;  Header name: {head}, Values:&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var vals = e.Context.Request.Headers.GetValues(head);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (var val in vals)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret += $&quot;{val} &quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += &quot;\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (e.Context.Request.ContentLength64 &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += $&quot;Size of content: {e.Context.Request.ContentLength64}\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] buff = new byte[e.Context.Request.ContentLength64];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.Context.Request.InputStream.Read(buff, 0, buff.Length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret += $&quot;Hex string representation:\r\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; buff.Length; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret += buff[i].ToString(&quot;X&quot;) + &quot; &quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebServer.OutPutStream(e.Context.Response, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This example is basic, but demonstrates how to access the HTTP method, the URL, URL parameters, content payload, and the controller called.</p><p>And more information, check <a href="https://github.com/nanoframework/Samples/tree/main/samples/Webserver" target="_blank" rel="noopener noreferrer">the complete example</a> for more about this WebServer!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-https">Using HTTPS<a class="hash-link" href="#using-https" title="Direct link to heading">​</a></h2><p>You will need to generate a certificate and keys:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">X509Certificate _myWebServerCertificate509 = new X509Certificate2(_myWebServerCrt, _myWebServerPrivateKey, &quot;1234&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// X509 RSA key PEM format 2048 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // generate with openssl:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // &gt; openssl req -newkey rsa:2048 -nodes -keyout selfcert.key -x509 -days 365 -out selfcert.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // and paste selfcert.crt content below:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private const string _myWebServerCrt =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@&quot;-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MORETEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----END CERTIFICATE-----&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // this one is generated with the command below. We need a password.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // &gt; openssl rsa -des3 -in selfcert.key -out selfcertenc.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // the one below was encoded with &#x27;1234&#x27; as the password.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private const string _myWebServerPrivateKey =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@&quot;-----BEGIN RSA PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MORETEXTANDENCRYPTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-----END RSA PRIVATE KEY-----&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using (WebServer server = new WebServer(443, HttpProtocol.Https)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add a handler for commands that are received by the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.CommandReceived += ServerCommandReceived;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.HttpsCert = _myWebServerCertificate509;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.SslProtocols = System.Net.Security.SslProtocols.Tls | System.Net.Security.SslProtocols.Tls11 | System.Net.Security.SslProtocols.Tls12;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Start the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread.Sleep(Timeout.Infinite);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>IMPORTANT: because the certificate above is not issued by a Certificate Authority it won&#x27;t be recognized as a valid certificate. If you want to access the nanoFramework device with your browser, for example, you&#x27;ll have to add the (CRT file)<!-- -->[WebServer.Sample\webserver-cert.crt]<!-- --> as a trusted one. On Windows, you just have to double click on the CRT file and then click &quot;Install Certificate...&quot;.</p></blockquote><p>You can use an event or controller or both. Anything that has been explained before without HTTPS will also work with HTTPS.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mqtt-loves-net-nanoframework">MQTT loves .NET nanoFramework<a class="hash-link" href="#mqtt-loves-net-nanoframework" title="Direct link to heading">​</a></h2><p>There is support for an MQTT client in .NET nanoFramework. You&#x27;ll find the source in the .NET nanoFramework <a href="https://github.com/nanoframework/nanoFramework.m2mqtt" target="_blank" rel="noopener noreferrer">MQTT</a> repository. The usage is the same whatever version is used, 3.1, 3.1.1, and 5.0 are supported. There are differences between v3.1.1 and v5.0. Version 5.0 brings more control and additional properties. For convenience, V5.0 properties are shown from Intellisense as <code>v5.0 only</code>. If you try to use v5.0 properties with the v3.1 or v3.1.1 protocols, they&#x27;ll be ignored.</p><p>Here is a basic example of creating a v3.1.1 server and connecting to it:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MqttClient mqtt = new MqttClient(&quot;test.mosquitto.org&quot;, 8883, true, new X509Certificate(CertMosquitto), null, MqttSslProtocols.TLSv1_2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var ret = mqtt.Connect(&quot;nanoTestDevice&quot;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (ret != MqttReasonCode.Success)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;ERROR connecting: {ret}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mqtt.Disconnect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the v5.0, you just need to specify the version before the connection:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MqttClient mqtt = new MqttClient(&quot;test.mosquitto.org&quot;, 8883, true, new X509Certificate(CertMosquitto), null, MqttSslProtocols.TLSv1_2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.ProtocolVersion = MqttProtocolVersion.Version_5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var ret = mqtt.Connect(&quot;nanoTestDevice&quot;, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (ret != MqttReasonCode.Success)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;ERROR connecting: {ret}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mqtt.Disconnect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: in both examples, a specific certificate is needed to connect to the Mosquitto server. You will find it in the <a href="https://github.com/nanoframework/nanoFramework.m2mqtt/tree/main/TestMqtt/TestAppv5.0" target="_blank" rel="noopener noreferrer">sample</a>. The v5.0 flow for authentication may be more complex and <a href="https://github.com/nanoframework/nanoFramework.m2mqtt#v50-specific-authentication-flow" target="_blank" rel="noopener noreferrer">is supported as well</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subscribing-to-events">Subscribing to events<a class="hash-link" href="#subscribing-to-events" title="Direct link to heading">​</a></h3><p>The MqttClient supports subscribing to events. For example, you can get additional information when a connection is opened with the v5.0 protocol. The example below shows how to connect to Azure IoT Hub over MQTT v5.0.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Create the client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MqttClient mqtt = new MqttClient(IoTHub, 8883, true, new X509Certificate(CertAzure), null, MqttSslProtocols.TLSv1_2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Setup the version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.ProtocolVersion = MqttProtocolVersion.Version_5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Register to events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.ConnectionOpened += MqttConnectionOpened;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You can add additional properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var at = DateTime.UtcNow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var atString = (at.ToUnixTimeSeconds() * 1000).ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var expiry = at.AddMinutes(40);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var expiryString = (expiry.ToUnixTimeSeconds() * 1000).ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string toSign = $&quot;{IoTHub}\n{DeviceID}\n\n{atString}\n{expiryString}\n&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var hmac = new HMACSHA256(Convert.FromBase64String(Sas));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var sas = hmac.ComputeHash(Encoding.UTF8.GetBytes(toSign));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.AuthenticationMethod = &quot;SAS&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.AuthenticationData = sas;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.UserProperties.Add(new UserProperty(&quot;sas-at&quot;, atString));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.UserProperties.Add(new UserProperty(&quot;sas-expiry&quot;, expiryString));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.UserProperties.Add(new UserProperty(&quot;api-version&quot;, &quot;2020-10-01-preview&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.UserProperties.Add(new UserProperty(&quot;host&quot;, IoTHub));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var ret = mqtt.Connect(DeviceID, null, null, false, MqttQoSLevel.AtLeastOnce, false, null, null, true, 60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You will have more code here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private static void MqttConnectionOpened(object sender, ConnectionOpenedEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Connection open&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  ClientID: {((MqttClient)sender).ClientId}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Assigned client id: {e.Message.AssignedClientIdentifier}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (e.Message.AuthenticationData != null) Debug.WriteLine($&quot;  Auth data length: {e.Message.AuthenticationData.Length}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Auth method: {e.Message.AuthenticationMethod}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Dup flag: {e.Message.DupFlag}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Max packet size: {e.Message.MaximumPacketSize}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Max QoS: {e.Message.MaximumQoS}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Msg ID: {e.Message.MessageId}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Qos level: {e.Message.QosLevel}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Reason: {e.Message.Reason}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Receive max: {e.Message.ReceiveMaximum}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Rep info: {e.Message.ResponseInformation}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Retain: {e.Message.Retain}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Retain available: {e.Message.RetainAvailable}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Return code: {e.Message.ReturnCode}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Server keep alive: {e.Message.ServerKeepAlive}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Server ref: {e.Message.ServerReference}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Session exp inter: {e.Message.SessionExpiryInterval}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Session present: {e.Message.SessionPresent}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Shared subs available: {e.Message.SharedSubscriptionAvailable}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Shared identifier available: {e.Message.SubscriptionIdentifiersAvailable}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Topic alias max: {e.Message.TopicAliasMaximum}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Num user props: {e.Message.UserProperties.Count}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (UserProperty prop in e.Message.UserProperties)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Debug.WriteLine($&quot;    Key  : {prop.Name}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Debug.WriteLine($&quot;    Value: {prop.Value}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;  Wildcard available: {e.Message.WildcardSubscriptionAvailable}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">​</a></h3><p>The M2Mqtt library provides the main class <code>MqttClient</code> that represents the MQTT client to connect to a broker. You can connect to the broker by providing its IP address or hostname and optionally some parameters related to MQTT protocol.</p><p>After connecting to the broker, use the <code>Publish()</code> method to publish a message to a topic and <code>Subscribe()</code> method to subscribe to a topic and receive messages published on it.</p><p>The <code>MqttClient</code> class is event-based, you receive an event when a message is published to a topic you subscribed to. You can receive events when message publishing is complete, and when subscribing or unsubscribing to topics.</p><p>Following is an example of client subscribing to a topic:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">string MQTT_BROKER_ADDRESS = &quot;192.168.1.2&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// create client instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MqttClient client = new MqttClient(IPAddress.Parse(MQTT_BROKER_ADDRESS));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// register to message received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.MqttMsgPublishReceived += client_MqttMsgPublishReceived;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string clientId = Guid.NewGuid().ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.Connect(clientId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// subscribe to the topic &quot;/home/temperature&quot; with QoS 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.Subscribe(new string[] { &quot;/home/temperature&quot; }, new MqttQoSLevel[] { MqttMsgBase.ExactlyOnce });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You can add some code here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void client_MqttMsgPublishReceived(object sender, MqttMsgPublishEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// handle message received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Following an example of client publisher to a topic :</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">string MQTT_BROKER_ADDRESS = &quot;192.168.1.2&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// create client instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MqttClient client = new MqttClient(IPAddress.Parse(MQTT_BROKER_ADDRESS));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string clientId = Guid.NewGuid().ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.Connect(clientId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string strValue = Convert.ToString(value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// publish a message on &quot;/home/temperature&quot; topic with QoS 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.Publish(&quot;/home/temperature&quot;, Encoding.UTF8.GetBytes(strValue), MqttQoSLevel.ExactlyOnce, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// More code goes here</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-certificate-check">Avoiding certificate check<a class="hash-link" href="#avoiding-certificate-check" title="Direct link to heading">​</a></h3><p>In some cases, it can be handy to avoid the certificate checks when connecting over a TLS connection. While this scenario is <strong>not</strong> recommended, you can adjust for it like this:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// You can specify no certificate at all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MqttClient mqtt = new MqttClient(IoTHub, 8883, true, null, null, MqttSslProtocols.TLSv1_2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// And you have to setup the ValidateServerCertificate to false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mqtt.Settings.ValidateServerCertificate = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string clientId = Guid.NewGuid().ToString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.Connect(clientId);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="websockets-and-signalr">WebSockets and SignalR<a class="hash-link" href="#websockets-and-signalr" title="Direct link to heading">​</a></h2><p>WebSockets and SignalR are supported. We do have a set of sample packs for all of them. </p><p>WebSockets can be used as a client, a server, or both at the same time. You&#x27;ll find the source in the .NET nanoFramework <a href="https://github.com/nanoframework/System.Net.WebSockets" target="_blank" rel="noopener noreferrer">WebSockets</a> and <a href="https://github.com/nanoframework/nanoFramework.SignalR.Client" target="_blank" rel="noopener noreferrer">SignalR</a> repositories.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="websockets-server-sample">WebSockets Server Sample<a class="hash-link" href="#websockets-server-sample" title="Direct link to heading">​</a></h3><p><a href="https://github.com/nanoframework/Samples/tree/main/samples/WebSockets/WebSockets.Server.RgbSample" target="_blank" rel="noopener noreferrer">Server.RgbSample</a> shows how to use WebSocket Server with a WebServer hosting a WebApp that controls the RGB led on an Atom Lite ESP32.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="websockets-client-sample">WebSockets Client Sample<a class="hash-link" href="#websockets-client-sample" title="Direct link to heading">​</a></h3><p><a href="https://github.com/nanoframework/Samples/tree/main/samples/WebSockets/Websockets.ServerClient.Sample" target="_blank" rel="noopener noreferrer">Client.Sample</a> shows how to use the WebSocket Client.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="websockets-server-and-client-sample">WebSockets Server and Client sample<a class="hash-link" href="#websockets-server-and-client-sample" title="Direct link to heading">​</a></h3><p><a href="https://github.com/nanoframework/Samples/tree/main/samples/WebSockets/Websockets.ServerClient.Sample" target="_blank" rel="noopener noreferrer">ServerClient.Sample</a> shows how to configure and start a WebSocket Server and (SSL) Client.</p><p>The SignalR Client library enables you to connect your .net nanoFramework device to a SignalR Hub.  SignalR is part of the ASP.NET Framework that makes it easy to create web applications that update in real-time. For IoT apps, SignalR can be used to create a web app to display a live graph of connected smart meters, or perhaps control a robot arm.</p><p>Important: You must be connected to a network with a valid IP address. Please check the examples with the Network Helpers on how to set this up.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-a-signalr-hub">Connecting to a SignalR hub<a class="hash-link" href="#connecting-to-a-signalr-hub" title="Direct link to heading">​</a></h3><p>Create a <code>HubConnection</code> client to establish a connection to a SignalR hub. You have to set the hub URL upon initialization of the HubConnection. You can also set custom headers by adding <code>ClientWebsocketHeaders</code> and set extra options by adding <code>HubConnectionOptions</code> upon initialization. The options are mainly used to change the settings of the underlying WebSocket and to set extra SSL options.
Start the connection by calling <code>Start</code>.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Diagnostics;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Threading;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using nanoFramework.SignalR.Client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace NFSignalrTestClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //setup connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var options = new HubConnectionOptions() { Reconnect = true };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HubConnection hubConnection = new HubConnection(&quot;http://YourSignalrTestServer/testhub&quot;, options: options);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hubConnection.Closed += HubConnection_Closed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hubConnection.On(&quot;ReceiveMessage&quot;, new Type[] { typeof(string), typeof(string) }, (sender, args) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var name = (string)args[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                var message = (string)args[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Console.WriteLine($&quot;{name} : {message}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //start connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hubConnection.Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AsyncResult dashboardClientConnected = hubConnection.InvokeCoreAsync(&quot;AwaitCientConnected&quot;, typeof(bool), new object[] { }, -1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int seconds = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (!dashboardClientConnected.Completed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Debug.WriteLine($&quot;Waited {seconds} for client to open webapp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                seconds++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Thread.Sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ((bool)dashboardClientConnected.Value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hubConnection.SendCore(&quot;ReportStatus&quot;, new object[] { &quot;Client Connected&quot; });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                int count = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                while (hubConnection.State == HubConnectionState.Connected)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    hubConnection.InvokeCore(&quot;SendMessage&quot;, null, new object[] { count, &quot;this is a control message&quot; });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    count++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Thread.Sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                hubConnection.Stop(&quot;client failed to connect&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private static void HubConnection_Closed(object sender, SignalrEventMessageArgs message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Debug.WriteLine($&quot;closed received with message: {message.Message}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handling-lost-signalr-connections">Handling lost SignalR connections<a class="hash-link" href="#handling-lost-signalr-connections" title="Direct link to heading">​</a></h3><p>Use retry policies to handle lost connections to a SignalR hub. To get the connection state, create an AsyncResult object and call methods to check the connection state.</p><p>The <code>AsyncResult</code> monitors the return message of the hub method. Upon completion, <code>Completed</code> will be true. Upon completion, the <code>Value</code> will hold the return object that needs to be cast to the right type. Calling <code>Value</code> before completion will result in the awaiting of the server return. If an error occurs, <code>Error</code> will be true and the error message will be inside <code>ErrorMessage</code>.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AsyncResult dashboardClientConnected = hubConnection.InvokeCoreAsync(&quot;AwaitCientConnected&quot;, typeof(bool), new object[] { }, -1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int seconds = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while (!dashboardClientConnected.Completed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Waited {seconds} for client to open webapp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seconds++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread.Sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ((bool)dashboardClientConnected.Value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine(&quot;The client connected to the dashboard, start sending live data&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="call-client-methods-from-a-signalr-hub">Call client methods from a Signalr hub<a class="hash-link" href="#call-client-methods-from-a-signalr-hub" title="Direct link to heading">​</a></h3><p>Define the method the hub calls using connection.On after building, but before starting the connection.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">connection.On&lt;string, string&gt;(&quot;ReceiveMessage&quot;, (sender, args) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var name = args[0] as string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var message = args[1] as string;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;{name} : {message}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The preceding code in connection.On runs when server-side code calls it using the SendAsync method.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public async Task SendMessage(string user, string message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    await Clients.All.SendAsync(&quot;ReceiveMessage&quot;, user, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="azure-library-all-you-need-is-there">Azure library: all you need is there!<a class="hash-link" href="#azure-library-all-you-need-is-there" title="Direct link to heading">​</a></h2><p>You&#x27;ll find the source in the .NET nanoFramework <a href="https://github.com/nanoframework/nanoFramework.Azure.Devices" target="_blank" rel="noopener noreferrer">Azure IoT library</a> repository.</p><p><strong>Important</strong>: You <strong>must</strong> be connected to a network with a valid IP address and date/time. Check the Network Helpers examples for information on IP addresses and syncing date and time.</p><p>The .NET nanoFramework Azure IoT Hub library uses the MQTT protocol. You need to ensure you can connect to port 8883 using TLS protocol. If you are connected to an enterprise network, this may be blocked. In most cases, this is not an issue.</p><p>To aid portability, the .NET nanoFramework Azure IoT Hub library aims to match the namespaces, class, and method names found in the full .NET C# Azure IoT SDK.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="certificates">Certificates<a class="hash-link" href="#certificates" title="Direct link to heading">​</a></h3><p>There are two options to provide an Azure IoT TLS certificate:</p><ul><li>Parse it <a href="https://github.com/nanoframework/nanoFramework.Azure.Devices/blob/main/README.md#through-the-constructor" target="_blank" rel="noopener noreferrer">into the constructor</a></li><li>Store it <a href="https://github.com/nanoframework/nanoFramework.Azure.Devices/blob/main/README.md#storing-the-certificate-on-the-device" target="_blank" rel="noopener noreferrer">on the device</a></li></ul><p>The <a href="https://github.com/nanoframework/nanoFramework.Azure.Devices/tree/main/AzureCertificates" target="_blank" rel="noopener noreferrer">AzureCertificates</a> contains, for your convenience, the root certificate used to connect to Azure IoT. Starting from June 2022, the Digicert Global Root 2 certificate must be used. For more information, refer to the <a href="https://techcommunity.microsoft.com/t5/internet-of-things/azure-iot-tls-critical-changes-are-almost-here-and-why-you/ba-p/2393169" target="_blank" rel="noopener noreferrer">Azure IoT TLS: Critical changes are almost here! (…and why you should care)</a> article.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-deviceclient">Creating a DeviceClient<a class="hash-link" href="#creating-a-deviceclient" title="Direct link to heading">​</a></h3><p>You can connect to Azure IoT Hub using either a symmetric Key or a certificate. The following example shows how to use a symmetric key:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const string DeviceID = &quot;nanoEdgeTwin&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string IotBrokerAddress = &quot;youriothub.azure-devices.net&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string SasKey = &quot;yoursaskey&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DeviceClient azureIoT = new DeviceClient(IotBrokerAddress, DeviceID, SasKey);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: please see the previous section to understand how to better parse the certificate for your usage. The example shows the certificate uploaded into the device and not in the code.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="azure-iot-plugplay">Azure IoT Plug&amp;Play<a class="hash-link" href="#azure-iot-plugplay" title="Direct link to heading">​</a></h3><p>Azure IoT Plug&amp;Play is supported, to use, provide a model ID when creating the DeviceClient:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DeviceClient azureIoT = new DeviceClient(IotBrokerAddress, DeviceID, SasKey, modelID:&quot;dtmi:com:example:Thermostat;1&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="iot-plugplay-property-updates">IoT Plug&amp;Play property updates<a class="hash-link" href="#iot-plugplay-property-updates" title="Direct link to heading">​</a></h4><p>The following example shows how to subscribe to property updates.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const string TargetTemperature = &quot;targetTemperature&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DeviceClient azureIoT = new DeviceClient(Secrets.IotHub, Secrets.DeviceName, Secrets.SasKey, azureCert: new X509Certificate(Resource.GetBytes(Resource.BinaryResources.AzureRoot)), modelId: &quot;dtmi:com:example:Thermostat;1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.TwinUpdated += AzureTwinUpdated;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.Open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void AzureTwinUpdated(object sender, TwinUpdateEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (e.Twin.Contains(TargetTemperature))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // We got an update for the target temperature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var target = e.Twin[TargetTemperature];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Debug.WriteLine($&quot;Target temperature updated: {target}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PropertyAcknowledge targetReport = new() { Version = (int)e.Twin.Version, Status = PropertyStatus.Completed, Description = &quot;All perfect&quot;, Value = target };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TwinCollection twin = new TwinCollection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twin.Add(TargetTemperature, targetReport.BuildAcknowledge());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        azureIoT.UpdateReportedProperties(twin);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the property we are interested in is called <code>targetTemperature</code>. To receive updates, we subscribe to twin updates. We get the twin value from a call to the <code>e.Twin[TargetTemperature]</code> method.</p><p>The pattern to publish a writable property is simple, just build a <code>PropertyAcknowledge</code> object, create a TwinCollection, and add the property name, in this case, <code>targetTemperature</code>.</p><p>You can add more than one property. Note that you add to the TwinCollection, once done, just ask the library to update the twin through the <code>UpdateReportedProperties</code> method.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="receiving-iot-plugplay-commands">Receiving IoT Plug&amp;Play commands<a class="hash-link" href="#receiving-iot-plugplay-commands" title="Direct link to heading">​</a></h4><p>An IoT Plug &amp; Play command is a method callback. The following example shows how to map an IoT Play &amp; Play command to a C# method. The method is called <code>getMaxMinReport</code>, the name of the C# method <strong>must</strong> match the command name as defined in the DTDL file.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DeviceClient azureIoT = new DeviceClient(Secrets.IotHub, Secrets.DeviceName, Secrets.SasKey, azureCert: new X509Certificate(Resource.GetBytes(Resource.BinaryResources.AzureRoot)), modelId: &quot;dtmi:com:example:Thermostat;1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.AddMethodCallback(getMaxMinReport);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.Open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string getMaxMinReport(int rid, string payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TemperatureReporting reporting = new() { avgTemp = 20, maxTemp = 42, minTemp = 12.34, startTime = DateTime.UtcNow.AddDays(-10), endTime = DateTime.UtcNow };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return JsonConvert.SerializeObject(reporting);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, the expected result is an object. Just populate the object and serialize it as a JSON as the command expect and return it. If any parameter to this command, it will be in the payload.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-and-updating-twin">Getting and updating Twin<a class="hash-link" href="#getting-and-updating-twin" title="Direct link to heading">​</a></h3><p>You can request the state of a Azure IoT Twin by calling the <code>GetTwin</code> method.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var twin = azureIoT.GetTwin(new CancellationTokenSource(20000).Token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (twin == null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Can&#x27;t get the twins&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    azureIoT.Close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Debug.WriteLine($&quot;Twin DeviceID: {twin.DeviceId}, #desired: {twin.Properties.Desired.Count}, #reported: {twin.Properties.Reported.Count}&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: it&#x27;s important to use a <code>CancellationToken</code> that will be canceled after a certain amount of time. Otherwise, this will block the calling thread up to the point the twin is received.</p><p>Twins have properties, reported and desired. They are collections and you can get or try to get any element.</p><p>You can report your Twin as simple as this:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TwinCollection reported = new TwinCollection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reported.Add(&quot;firmware&quot;, &quot;myNano&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reported.Add(&quot;sdk&quot;, 0.2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.UpdateReportedProperties(reported);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You also have the option to wait for the twin update confirmation, in this case, use a <code>CancellationToken</code> that can be canceled. Otherwise, the check will be ignored.</p><p>Note: the function will return false if the twin reception confirmation is not checked or if it did not arrive on time.</p><p>You can also register for any twin update:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.TwinUpdated += TwinUpdatedEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void TwinUpdatedEvent(object sender, TwinUpdateEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Twin update received: {e.Twin.Count}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sending-message">Sending message<a class="hash-link" href="#sending-message" title="Direct link to heading">​</a></h3><p>Use the <code>SendMessage</code> function to send messages to Azure IoT. Use a <code>CancellationToken</code> to ensure message delivery. If a CancellationToken is not provided, then delivery assurance will be ignored and the function will return false.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var isReceived = azureIoT.SendMessage($&quot;{{\&quot;Temperature\&quot;:42,\&quot;Pressure\&quot;:1024}}&quot;, new CancellationTokenSource(5000).Token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Debug.WriteLine($&quot;Message received by IoT Hub: {isReceived}&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: The message will be sent with the default service quality of service you created the device with. You won&#x27;t get any answer for the quality <code>0</code>. In this case, you can simplify it to:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.SendMessage($&quot;{{\&quot;Temperature\&quot;:42,\&quot;Pressure\&quot;:1024}}&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloud-to-device-messages">Cloud to device messages<a class="hash-link" href="#cloud-to-device-messages" title="Direct link to heading">​</a></h3><p>You can register an event to receive Cloud to device messages:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.CloudToDeviceMessage += CloudToDeviceMessageEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The following example shows how to display all keys in debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void CloudToDeviceMessageEvent(object sender, CloudToDeviceMessageEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Message arrived: {e.Message}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (string key in e.Properties.Keys)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Debug.Write($&quot;  Key: {key} = &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (e.Properties[key] == null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Debug.WriteLine(&quot;null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Debug.WriteLine((string)e.Properties[key]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // e.Message contains the message itself</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(e.Message == &quot;stop&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ShoudIStop = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: the <code>sender</code> is a <code>DeviceClient</code> class, you can then send a confirmation message back, or execute any logic you&#x27;ve put in place.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-callback">Method callback<a class="hash-link" href="#method-callback" title="Direct link to heading">​</a></h3><p>Method callback is supported as well. You can register and unregister your methods. Here are a few examples:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.AddMethodCallback(MethodCallbackTest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.AddMethodCallback(MakeAddition);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.AddMethodCallback(RaiseExceptionCallbackTest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string MethodCallbackTest(int rid, string payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Call back called :-) rid={rid}, payload={payload}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;{\&quot;Yes\&quot;:\&quot;baby\&quot;,\&quot;itisworking\&quot;:42}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string MakeAddition(int rid, string payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Hashtable variables = (Hashtable)JsonConvert.DeserializeObject(payload, typeof(Hashtable));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int arg1 = (int)variables[&quot;arg1&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int arg2 = (int)variables[&quot;arg2&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return $&quot;{{\&quot;result\&quot;:{arg1 + arg2}}}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">string RaiseExceptionCallbackTest(int rid, string payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // This will properly return as well the exception error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new Exception(&quot;I got you, it&#x27;s to test the 504&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>Important</strong>: method names are case-sensitive. So make sure you name your functions in C# using the same case.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="status-update-event">Status update event<a class="hash-link" href="#status-update-event" title="Direct link to heading">​</a></h3><p>A status update event is available:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">azureIoT.StatusUpdated += StatusUpdatedEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void StatusUpdatedEvent(object sender, StatusUpdatedEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Status changed: {e.IoTHubStatus.Status}, {e.IoTHubStatus.Message}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // You may want to reconnect or use a similar retry mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ////if (e.IoTHubStatus.Status == Status.Disconnected)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ////{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ////    mqtt.Open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ////}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that those are status change based, so once the connect or disconnect event arrives, they&#x27;ll be replaced by other events as soon as something else happened like receiving a twin.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="qos-level">QoS Level<a class="hash-link" href="#qos-level" title="Direct link to heading">​</a></h3><p>By default, connections to an IoT Hub use QoS 1 for message exchange with the IoT hub. You can change this by setting the <code>qosLevel</code> argument of the <code>DeviceClient</code> constructor.</p><p>Here are existing QoS levels that you can use:</p><ul><li>AtMostOnce: The broker/client will deliver the message once, with no confirmation.</li><li>AtLeastOnce: The broker/client will deliver the message at least once, with confirmation required.</li><li>ExactlyOnce: The broker/client will deliver the message exactly once by using a four-step handshake.</li></ul><p>While it&#x27;s possible to configure QoS 0 (AtMostOnce) for faster message exchange, you should note that the delivery isn&#x27;t guaranteed nor acknowledged. For this reason, QoS 0 is often referred as &quot;fire and forget&quot;.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="module-support">Module support<a class="hash-link" href="#module-support" title="Direct link to heading">​</a></h3><p>Modules are supported, you will have to use the constructor to pass the module ID either with a SAS token or with a certificate. The rest works like a normal device. Everything is supported including module direct method, telemetry and twins!</p><p>For example here with a SAS token. Note that the certificates are fully supported as well. And if you are not storing the Azure root certificate on the device, you&#x27;ll need to pass it to the constructor.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const string DeviceID = &quot;nanoEdgeTwin&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string ModuleID = &quot;myModule&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string IotBrokerAddress = &quot;youriothub.azure-devices.net&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string SasKey = &quot;yoursaskey&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DeviceClient module = new DeviceClient(IotBrokerAddress, DeviceID, ModuleID, SasKey);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="azure-iot-device-provisioning-service-dps-support">Azure IoT Device Provisioning Service (DPS) support<a class="hash-link" href="#azure-iot-device-provisioning-service-dps-support" title="Direct link to heading">​</a></h3><p>This SDK also supports the Azure IoT Device Provisioning Service. Group and individual provisioning scenarios are supported either with a symmetric key or with certificates. To understand the mechanism behind DPS, it is recommended to read the <a href="https://docs.microsoft.com/azure/iot-dps/?wt.mc_id=eventspg_16482_webpage_reactor" target="_blank" rel="noopener noreferrer">documentation</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="provisioning-using-symmetric-key">Provisioning using symmetric key<a class="hash-link" href="#provisioning-using-symmetric-key" title="Direct link to heading">​</a></h3><p>For symmetric key provisioning you only need the following elements:</p><ul><li>A registration ID</li><li>The ID Scope</li><li>The device name</li><li>The key or the derived key for group provisioning</li></ul><p>The code is then straight forward:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const string RegistrationID = &quot;nanoDPStTest&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string DpsAddress = &quot;global.azure-devices-provisioning.net&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string IdScope = &quot;0ne01234567&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const string SasKey = &quot;alongkeyencodedbase64&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// See the previous sections in the SDK help, you either need to have the Azure certificate embedded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Either passing it in the constructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X509Certificate azureCA = new X509Certificate(DpsSampleApp.Resources.GetBytes(DpsSampleApp.Resources.BinaryResources.BaltimoreRootCA_crt));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var provisioning = ProvisioningDeviceClient.Create(DpsAddress, IdScope, RegistrationID, SasKey, azureCA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var myDevice = provisioning.Register(new CancellationTokenSource(60000).Token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(myDevice.Status != ProvisioningRegistrationStatusType.Assigned)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;Registration is not assigned: {myDevice.Status}, error message: {myDevice.ErrorMessage}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// You can then create the device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var device = new DeviceClient(myDevice.AssignedHub, myDevice.DeviceId, SasKey, nanoFramework.M2Mqtt.Messages.MqttQoSLevel.AtLeastOnce, azureCA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Open it and continue like for the previous sections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var res = device.Open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(!res)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Debug.WriteLine($&quot;can&#x27;t open the device&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In case a <a href="https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md" target="_blank" rel="noopener noreferrer">DPS model</a> is going to be used, the ID of the model has to be passed to the ProvisioningDeviceClient and DeviceClient constructor.
The code above requires the following changes.</p><p>Add the model ID as a constant:</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public const string ModelId = &quot;dtmi:orgpal:palthree:palthree_demo_0;1&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create the additional payload information with the model ID to be sent along with the registration with DPS and pass that to the call to <code>Register()</code>.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var pnpPayload = new ProvisioningRegistrationAdditionalData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JsonData = PnpConvention.CreateDpsPayload(ModelId),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var myDevice = provisioning.Register(pnpPayload, new CancellationTokenSource(60000).Token);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create the device client passing the model ID to the respective parameter in the constructor.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var device = new DeviceClient(myDevice.AssignedHub, myDevice.DeviceId, SasKey, nanoFramework.M2Mqtt.Messages.MqttQoSLevel.AtLeastOnce, azureCA, ModelId);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: like for the <code>DeviceClient</code> you need to make sure you are connected to a network properly and also have the date and time set on the device.</p><p>Provisioning using certificates is supported as well and <a href="https://github.com/nanoframework/nanoFramework.Azure.Devices#provisioning-using-certificates" target="_blank" rel="noopener noreferrer">described here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-payload">Additional payload<a class="hash-link" href="#additional-payload" title="Direct link to heading">​</a></h3><p>Additional payload is supported as well. You can set it as a JSON string in the <code>ProvisioningRegistrationAdditionalData</code> class when calling the <code>Register</code> function. When the device has been provisioned, you may have as well additional payload provided.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-on-battery-for-8-years-and-connecting-to-azure">Running on battery for 8 years and connecting to Azure<a class="hash-link" href="#running-on-battery-for-8-years-and-connecting-to-azure" title="Direct link to heading">​</a></h2><p>One of the advantages of MCU is their low consumption and ability to deep sleep very long even when connecting to Azure. You&#x27;ll find a full article describing some of the secrets <a href="https://devblogs.microsoft.com/dotnet/show-dotnet-running-my-net-nanoframework-for-8-years-on-a-battery/" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>In this (long) article, we hope we have demonstrated <strong>all</strong> you need to connect your MCU using .NET nanoFramework to almost anything! As a recap, here are the repositories related to networking in .NET nanoFramework:</p><ul><li><a href="https://github.com/nanoframework/System.Net.Sockets.TcpClient" target="_blank" rel="noopener noreferrer">TcpClient</a>,</li><li><a href="https://github.com/nanoframework/System.Net.Sockets.UdpClient" target="_blank" rel="noopener noreferrer">UdpClient</a>,</li><li><a href="https://github.com/nanoframework/System.Net.Http" target="_blank" rel="noopener noreferrer">System.Net.Http</a>,</li><li><a href="https://github.com/nanoframework/nanoFramework.WebServer" target="_blank" rel="noopener noreferrer">WebServer</a>,</li><li><a href="https://github.com/nanoframework/System.Net.WebSockets" target="_blank" rel="noopener noreferrer">WebSockets</a>,</li><li><a href="https://github.com/nanoframework/nanoFramework.SignalR.Client" target="_blank" rel="noopener noreferrer">SignalR</a>,</li><li><a href="https://github.com/nanoframework/amqpnetlite" target="_blank" rel="noopener noreferrer">AMQP</a>,</li><li><a href="https://github.com/nanoframework/nanoFramework.m2mqtt" target="_blank" rel="noopener noreferrer">MQTT</a>,</li><li><a href="https://github.com/nanoframework/nanoFramework.Azure.Devices" target="_blank" rel="noopener noreferrer">Azure IoT library</a>,</li><li>And of course, the Sample pack related to <a href="https://github.com/nanoframework/Samples#networking-including-http-ssl" target="_blank" rel="noopener noreferrer">networking</a>, <a href="https://github.com/nanoframework/Samples#mqtt" target="_blank" rel="noopener noreferrer">MQTT</a>, <a href="https://github.com/nanoframework/Samples#amqp" target="_blank" rel="noopener noreferrer">AMQP</a>, and <a href="https://github.com/nanoframework/Samples#azure-specific" target="_blank" rel="noopener noreferrer">Azure</a></li></ul><p>Next Friday, we&#x27;ll see an advanced scenario: rebuilding fully a .NET nanoFramework image and including native C interoperability. Stay tuned! And as always, feedback is welcome!</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/30-days">30days</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/iot">iot</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/embeddediot">embeddediot</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/15-julyot-iot-beginners"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">15: IoT for Beginners lesson 3!</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/14-iot-cow"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">14: AMA: IoT, cows, AI and poop - Jim discusses IoT in farming with Bryn Lewis</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#announcing-the-first-net-nanoframework-azure-certified-device" class="table-of-contents__link toc-highlight">Announcing the first .NET nanoFramework Azure Certified Device</a></li><li><a href="#net-nanoframework-communications-capabilities" class="table-of-contents__link toc-highlight">.NET nanoFramework communications capabilities</a></li><li><a href="#tls-and-https" class="table-of-contents__link toc-highlight">TLS and HTTPS</a><ul><li><a href="#perform-an-http-get-request" class="table-of-contents__link toc-highlight">Perform an HTTP GET request</a></li><li><a href="#perform-an-http-post-request" class="table-of-contents__link toc-highlight">Perform an HTTP POST request</a></li><li><a href="#download-binary-content-to-a-file" class="table-of-contents__link toc-highlight">Download binary content to a file</a></li><li><a href="#debugging-through-a-reverse-proxy" class="table-of-contents__link toc-highlight">Debugging through a reverse proxy</a></li></ul></li><li><a href="#webserver-almost-like-full-aspnet" class="table-of-contents__link toc-highlight">WebServer: almost like full ASP.NET</a><ul><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#managing-incoming-queries-thru-events" class="table-of-contents__link toc-highlight">Managing incoming queries thru events</a></li></ul></li><li><a href="#using-https" class="table-of-contents__link toc-highlight">Using HTTPS</a></li><li><a href="#mqtt-loves-net-nanoframework" class="table-of-contents__link toc-highlight">MQTT loves .NET nanoFramework</a><ul><li><a href="#subscribing-to-events" class="table-of-contents__link toc-highlight">Subscribing to events</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#avoiding-certificate-check" class="table-of-contents__link toc-highlight">Avoiding certificate check</a></li></ul></li><li><a href="#websockets-and-signalr" class="table-of-contents__link toc-highlight">WebSockets and SignalR</a><ul><li><a href="#websockets-server-sample" class="table-of-contents__link toc-highlight">WebSockets Server Sample</a></li><li><a href="#websockets-client-sample" class="table-of-contents__link toc-highlight">WebSockets Client Sample</a></li><li><a href="#websockets-server-and-client-sample" class="table-of-contents__link toc-highlight">WebSockets Server and Client sample</a></li><li><a href="#connecting-to-a-signalr-hub" class="table-of-contents__link toc-highlight">Connecting to a SignalR hub</a></li><li><a href="#handling-lost-signalr-connections" class="table-of-contents__link toc-highlight">Handling lost SignalR connections</a></li><li><a href="#call-client-methods-from-a-signalr-hub" class="table-of-contents__link toc-highlight">Call client methods from a Signalr hub</a></li></ul></li><li><a href="#azure-library-all-you-need-is-there" class="table-of-contents__link toc-highlight">Azure library: all you need is there!</a><ul><li><a href="#certificates" class="table-of-contents__link toc-highlight">Certificates</a></li><li><a href="#creating-a-deviceclient" class="table-of-contents__link toc-highlight">Creating a DeviceClient</a></li><li><a href="#azure-iot-plugplay" class="table-of-contents__link toc-highlight">Azure IoT Plug&amp;Play</a></li><li><a href="#getting-and-updating-twin" class="table-of-contents__link toc-highlight">Getting and updating Twin</a></li><li><a href="#sending-message" class="table-of-contents__link toc-highlight">Sending message</a></li><li><a href="#cloud-to-device-messages" class="table-of-contents__link toc-highlight">Cloud to device messages</a></li><li><a href="#method-callback" class="table-of-contents__link toc-highlight">Method callback</a></li><li><a href="#status-update-event" class="table-of-contents__link toc-highlight">Status update event</a></li><li><a href="#qos-level" class="table-of-contents__link toc-highlight">QoS Level</a></li><li><a href="#module-support" class="table-of-contents__link toc-highlight">Module support</a></li><li><a href="#azure-iot-device-provisioning-service-dps-support" class="table-of-contents__link toc-highlight">Azure IoT Device Provisioning Service (DPS) support</a></li><li><a href="#provisioning-using-symmetric-key" class="table-of-contents__link toc-highlight">Provisioning using symmetric key</a></li><li><a href="#additional-payload" class="table-of-contents__link toc-highlight">Additional payload</a></li></ul></li><li><a href="#running-on-battery-for-8-years-and-connecting-to-azure" class="table-of-contents__link toc-highlight">Running on battery for 8 years and connecting to Azure</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Microsoft - Built by @AzureAdvocates using @Docusaurus ♥️</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ac7cffa6.js"></script>
<script src="/assets/js/main.8e07fc21.js"></script>
</body>
</html>